<!-- src/main/resources/static/post-detail.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê²Œì‹œê¸€ ìƒì„¸</title>
  <style>
    body { font-family: sans-serif; padding: 40px; }
    input, textarea { display: block; margin-bottom: 10px; width: 100%; padding: 8px; }
    button { padding: 8px 16px; margin-right: 10px; }
  </style>
</head>
<body>
  <h2>ğŸ“„ ê²Œì‹œê¸€ ìƒì„¸</h2>
  <input type="text" id="title" placeholder="ì œëª©" />
  <textarea id="content" rows="10" placeholder="ë‚´ìš© ì…ë ¥..."></textarea>
  <p id="author">ì‘ì„±ì: </p>

  <button onclick="updatePost()">âœï¸ ìˆ˜ì •</button>
  <button onclick="deletePost()">ğŸ—‘ï¸ ì‚­ì œ</button>
  <button onclick="location.href='posts.html'">ğŸ“‹ ëª©ë¡ìœ¼ë¡œ</button>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get("id");
    const token = localStorage.getItem("token");

    if (!id) {
      alert("âŒ ê²Œì‹œê¸€ IDê°€ ì—†ìŠµë‹ˆë‹¤.");
      location.href = "posts.html";
    }

    fetch(`http://localhost:8081/api/posts/${id}`)
      .then(res => {
        if (!res.ok) throw new Error("ê²Œì‹œê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return res.json();
      })
      .then(post => {
        document.getElementById("title").value = post.title;
        document.getElementById("content").value = post.content;
        document.getElementById("author").textContent = "ì‘ì„±ì: " + post.authorName;
      })
      .catch(err => {
        alert("âŒ ê²Œì‹œê¸€ ë¡œë”© ì‹¤íŒ¨: " + err.message);
        location.href = "posts.html";
      });

    function updatePost() {
      const title = document.getElementById("title").value;
      const content = document.getElementById("content").value;

      fetch(`http://localhost:8081/api/posts/${id}`, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + token
        },
        body: JSON.stringify({ title, content })
      })
      .then(res => {
        if (res.ok) {
          alert("âœ… ìˆ˜ì • ì„±ê³µ");
          location.href = "posts.html";
        } else {
          alert("âŒ ìˆ˜ì • ì‹¤íŒ¨");
        }
      });
    }

    function deletePost() {
      fetch(`http://localhost:8081/api/posts/${id}`, {
        method: "DELETE",
        headers: {
          "Authorization": "Bearer " + token
        }
      })
      .then(res => {
        if (res.ok) {
          alert("ğŸ—‘ï¸ ì‚­ì œ ì™„ë£Œ");
          location.href = "posts.html";
        } else {
          alert("âŒ ì‚­ì œ ì‹¤íŒ¨");
        }
      });
    }
  </script>
</body>
</html>